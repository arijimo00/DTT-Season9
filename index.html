<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player Auction System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Styles */
        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .header h1 {
            color: #764ba2;
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        /* Current Bid Display */
        .current-bid-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            color: white;
            text-align: center;
        }

        .player-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .info-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .info-card h3 {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .info-card p {
            font-size: 1.5em;
            font-weight: bold;
        }

        /* Timer Styles */
        .timers-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .timer-card {
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: all 0.3s;
        }

        .timer-card.inactive {
            background: #6c757d;
            color: white;
        }

        .timer-card.active {
            background: #dc3545;
            color: white;
        }

        .timer-display {
            font-size: 3em;
            font-weight: bold;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
        }

        .timer-card.inactive .timer-display {
            color: rgba(255, 255, 255, 0.8);
        }

        .timer-card.active .timer-display {
            color: white;
        }

        /* Nomination Section */
        .nomination-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        .nomination-form {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 15px;
            align-items: end;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 5px;
            font-weight: bold;
            color: #764ba2;
        }

        .form-group input {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }

        .form-group input:focus {
            border-color: #667eea;
            outline: none;
        }

        /* Team Sections */
        .teams-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .team-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }

        .team-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }

        .team-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .team-logo {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.5em;
            margin-right: 15px;
        }

        .team-info h3 {
            color: #333;
            margin-bottom: 5px;
        }

        .coaches {
            font-size: 0.9em;
            color: #666;
        }

        .budget-display {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: center;
        }

        .budget-amount {
            font-size: 2em;
            font-weight: bold;
            color: #28a745;
        }

        .bid-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .bid-btn {
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .bid-btn:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .bid-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .bid-btn.max-bid {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            grid-column: span 3;
        }

        .custom-bid-container {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 10px;
        }

        .custom-bid-input {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
        }

        /* Admin Console */
        .admin-console {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        .admin-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .admin-btn {
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .admin-btn.start {
            background: #28a745;
            color: white;
        }

        .admin-btn.pause {
            background: #ffc107;
            color: #333;
        }

        .admin-btn.undo {
            background: #17a2b8;
            color: white;
        }

        .admin-btn.reset {
            background: #dc3545;
            color: white;
        }

        .admin-btn.export {
            background: #6610f2;
            color: white;
        }

        .admin-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        /* Data Tables */
        .data-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        .data-section h2 {
            color: #764ba2;
            margin-bottom: 15px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .data-table th {
            background: #f8f9fa;
            font-weight: bold;
            color: #667eea;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        /* Team Setup Styles */
        #team-setup-table input[type="text"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        #team-setup-table input[type="file"] {
            font-size: 12px;
        }

        .logo-preview {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            display: block;
            margin-top: 5px;
        }

        .clear-btn {
            padding: 5px 10px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }

        .clear-btn:hover {
            background: #c82333;
        }

        /* Setup Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: #764ba2;
        }

        .setup-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .setup-form .form-group {
            display: flex;
            flex-direction: column;
        }

        .setup-form textarea {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            min-height: 100px;
            resize: vertical;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .modal-btn.primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .modal-btn.secondary {
            background: #f0f0f0;
            color: #333;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .teams-grid {
                grid-template-columns: 1fr;
            }

            .nomination-form {
                grid-template-columns: 1fr;
            }

            .bid-buttons {
                grid-template-columns: repeat(2, 1fr);
            }

            .timer-display {
                font-size: 2em;
            }
        }

        /* Player Management Styles */
        .player-tag {
            display: inline-flex;
            align-items: center;
            padding: 8px 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .player-tag:hover {
            transform: scale(1.05);
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);
        }

        .player-tag .remove-player {
            margin-left: 8px;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: all 0.3s;
        }

        .player-tag .remove-player:hover {
            background: rgba(255, 255, 255, 0.4);
        }

        /* Team Roster Cards */
        .roster-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 2px solid rgba(102, 126, 234, 0.2);
        }

        .roster-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(102, 126, 234, 0.3);
        }

        .roster-logo {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.2em;
            margin-right: 12px;
            overflow: hidden;
        }

        .roster-logo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .roster-info {
            flex-grow: 1;
        }

        .roster-info h4 {
            margin: 0;
            color: #333;
            font-size: 1.1em;
        }

        .roster-stats {
            display: flex;
            gap: 15px;
            font-size: 0.85em;
            color: #666;
            margin-top: 3px;
        }

        .roster-players {
            min-height: 100px;
            max-height: 250px;
            overflow-y: auto;
        }

        .roster-player {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 8px 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            transition: all 0.3s;
        }

        .roster-player:hover {
            transform: translateX(5px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .roster-player .player-name {
            font-weight: 600;
            color: #333;
        }

        .roster-player .player-cost {
            color: #28a745;
            font-weight: bold;
        }

        .roster-empty {
            text-align: center;
            color: #999;
            padding: 30px;
            font-style: italic;
        }

        .roster-summary {
            margin-top: 15px;
            padding-top: 12px;
            border-top: 2px solid rgba(102, 126, 234, 0.3);
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
        }

        .roster-summary .budget-left {
            color: #28a745;
            font-weight: bold;
        }

        .roster-summary .total-spent {
            color: #dc3545;
            font-weight: bold;
        }

        /* Animations */
        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
            100% {
                transform: scale(1);
            }
        }

        .pulse-animation {
            animation: pulse 2s infinite;
        }

        .highlight-bid {
            background: linear-gradient(135deg, #ffd93d 0%, #ffb347 100%) !important;
            animation: pulse 1s;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .player-tag {
            animation: slideIn 0.3s ease-out;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üèÜ Player Auction System</h1>
        </div>

        <!-- Current Bid Display -->
        <div class="current-bid-display">
            <h2 style="margin-bottom: 20px;">Current Auction</h2>
            <div class="player-info">
                <div class="info-card">
                    <h3>Current Player</h3>
                    <p id="current-player">-</p>
                </div>
                <div class="info-card" style="display: flex; flex-direction: column; gap: 10px;">
                    <div>
                        <h3 style="margin-bottom: 5px;">Previous Bid</h3>
                        <p id="previous-bid" style="color: #ffb3b3; margin: 0;">-</p>
                    </div>
                    <div>
                        <h3 style="margin-bottom: 5px;">Previous Leader</h3>
                        <p id="previous-leader" style="margin: 0;">-</p>
                    </div>
                </div>
                <div class="info-card" style="display: flex; flex-direction: column; gap: 10px;">
                    <div>
                        <h3 style="margin-bottom: 5px;">Current Bid</h3>
                        <p id="current-bid" style="color: #ffd93d; margin: 0;">-</p>
                    </div>
                    <div>
                        <h3 style="margin-bottom: 5px;">Leading Team</h3>
                        <p id="leading-team" style="margin: 0;">-</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Timers -->
        <div class="timers-section">
            <div class="timer-card inactive" id="countdown-timer-card">
                <h3>‚è∞ Bid Countdown</h3>
                <div class="timer-display" id="countdown-timer">--</div>
                <p>Last chance to bid!</p>
            </div>
            <div class="timer-card inactive" id="nomination-timer-card">
                <h3>‚è±Ô∏è Nomination Timer</h3>
                <div class="timer-display" id="nomination-timer">--</div>
                <p>Time to nominate</p>
            </div>
        </div>

        <!-- Nomination Section -->
        <div class="nomination-section">
            <h2 style="color: #764ba2; margin-bottom: 15px;">Player Nomination - <span id="nomination-team-name">Waiting to Start</span></h2>
            <div class="nomination-form">
                <div class="form-group">
                    <label>Player Name</label>
                    <input type="text" id="player-name-input" placeholder="Enter player name">
                </div>
                <div class="form-group">
                    <label>Starting Bid (k)</label>
                    <input type="number" id="starting-bid-input" placeholder="Min: 2k" min="2" step="0.5">
                </div>
                <button class="bid-btn" onclick="nominatePlayer()">Nominate</button>
            </div>
        </div>

        <!-- Team Bidding Sections -->
        <div class="teams-grid" id="teams-container">
            <!-- Teams will be dynamically generated here -->
        </div>

        <!-- Team Setup Section -->
        <div class="data-section" id="team-setup-section">
            <h2>Team Setup</h2>
            <p style="color: #666; margin-bottom: 15px;">Configure all teams before starting the auction</p>
            <div style="overflow-x: auto;">
                <table class="data-table" id="team-setup-table">
                    <thead>
                        <tr>
                            <th>Team #</th>
                            <th>Team Name</th>
                            <th>Coaches Names</th>
                            <th>Logo</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Team rows will be generated here -->
                    </tbody>
                </table>
            </div>
            <div style="margin-top: 15px; display: flex; gap: 10px;">
                <button class="admin-btn" style="background: #28a745;" onclick="saveTeamSetup()">üíæ Save Team Configuration</button>
                <button class="admin-btn" style="background: #17a2b8;" onclick="loadDefaultTeams()">üìù Load Sample Teams</button>
            </div>
        </div>

        <!-- Team Rosters Section -->
        <div class="data-section">
            <h2>Current Team Rosters</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
                <div id="team-rosters" style="display: contents;">
                    <!-- Team roster cards will be populated here -->
                </div>
            </div>
        </div>

        <!-- Player Management Section -->
        <div class="data-section" id="player-management-section">
            <h2>Player Management</h2>
            <div style="margin-bottom: 20px;">
                <div class="form-group" style="margin-bottom: 15px;">
                    <label style="font-weight: bold; color: #764ba2; margin-bottom: 5px; display: block;">Add Players (one per line or comma-separated)</label>
                    <textarea id="player-input" style="width: 100%; min-height: 100px; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;" placeholder="Enter player names...
Example:
Virat Kohli
MS Dhoni
Rohit Sharma
or
Player1, Player2, Player3"></textarea>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                    <button class="admin-btn" style="background: #28a745;" onclick="addPlayers()">‚ûï Add Players</button>
                    <button class="admin-btn" style="background: #dc3545;" onclick="clearPlayerInput()">üóëÔ∏è Clear Input</button>
                    <button class="admin-btn" style="background: #17a2b8;" onclick="loadSamplePlayers()">üìã Load Sample Players</button>
                </div>
            </div>
            
            <div style="margin-bottom: 15px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <strong>Total Available Players:</strong> <span id="available-count" style="color: #28a745; font-size: 1.2em;">0</span>
                    </div>
                    <div>
                        <strong>Already Drafted:</strong> <span id="drafted-count" style="color: #dc3545; font-size: 1.2em;">0</span>
                    </div>
                </div>
            </div>

            <div style="margin-bottom: 15px;">
                <input type="text" id="player-search" placeholder="üîç Search players..." style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;" onkeyup="searchPlayers()">
            </div>

            <div style="max-height: 300px; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 8px; padding: 10px;">
                <div id="available-players-list" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px;">
                    <!-- Players will be displayed here -->
                </div>
            </div>
        </div>

        <!-- Admin Console -->
        <div class="admin-console">
            <h2 style="color: #764ba2; margin-bottom: 15px;">Admin Console</h2>
            <div class="admin-buttons">
                <button class="admin-btn start" onclick="startAuction()">‚ñ∂Ô∏è Start Auction</button>
                <button class="admin-btn pause" onclick="pauseAuction()">‚è∏Ô∏è Pause Auction</button>
                <button class="admin-btn undo" onclick="undoLastBid()">‚Ü©Ô∏è Undo Last Bid</button>
                <button class="admin-btn reset" onclick="resetAuction()">üîÑ Reset Auction</button>
                <button class="admin-btn export" onclick="exportData()">üìä Export to Sheets</button>
            </div>
        </div>

        <!-- Bid History -->
        <div class="data-section">
            <h2>Bid History</h2>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Timestamp</th>
                        <th>Player</th>
                        <th>Team</th>
                        <th>Bid Amount</th>
                    </tr>
                </thead>
                <tbody id="bid-history">
                    <!-- Bid history will be populated here -->
                </tbody>
            </table>
        </div>

        <!-- Drafted Players -->
        <div class="data-section">
            <h2>Drafted Players - History</h2>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Player</th>
                        <th>Team</th>
                        <th>Final Bid</th>
                    </tr>
                </thead>
                <tbody id="drafted-players">
                    <!-- Drafted players will be populated here -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Global State
        let auctionState = {
            isActive: false,
            isPaused: false,
            currentPlayer: null,
            nominatingTeam: null,
            initialBid: 0,
            currentBid: 0,
            leadingTeam: null,
            previousBid: 0,
            previousLeader: null,
            teams: [],
            bidHistory: [],
            draftedPlayers: [],
            availablePlayers: [],
            nominationOrder: [],
            currentNominationIndex: 0,
            roundNumber: 1
        };

        // Timer State
        let countdownTimer = null;
        let countdownValue = 5;
        let nominationTimer = null;
        let nominationValue = 90; // 1:30 in seconds
        let bidCooldownTimer = null;

        // Initialize Team Setup Table
        function initializeTeamSetupTable() {
            const tbody = document.querySelector('#team-setup-table tbody');
            tbody.innerHTML = '';
            
            for (let i = 0; i < 6; i++) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>Team ${i + 1}</td>
                    <td>
                        <input type="text" id="team-name-${i}" placeholder="Enter team name" value="">
                    </td>
                    <td>
                        <input type="text" id="team-coaches-${i}" placeholder="Coach names" value="">
                    </td>
                    <td>
                        <input type="file" id="team-logo-${i}" accept="image/*" onchange="previewLogo(${i})">
                        <img id="logo-preview-${i}" class="logo-preview" style="display: none;">
                    </td>
                    <td>
                        <button class="clear-btn" onclick="clearTeamRow(${i})">Clear</button>
                    </td>
                `;
                tbody.appendChild(row);
            }
        }

        // Preview Logo
        function previewLogo(teamIndex) {
            const input = document.getElementById(`team-logo-${teamIndex}`);
            const preview = document.getElementById(`logo-preview-${teamIndex}`);
            
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        // Clear Team Row
        function clearTeamRow(index) {
            document.getElementById(`team-name-${index}`).value = '';
            document.getElementById(`team-coaches-${index}`).value = '';
            document.getElementById(`team-logo-${index}`).value = '';
            const preview = document.getElementById(`logo-preview-${index}`);
            preview.src = '';
            preview.style.display = 'none';
        }

        // Save Team Setup
        function saveTeamSetup() {
            const teams = [];
            let hasError = false;
            
            for (let i = 0; i < 6; i++) {
                const name = document.getElementById(`team-name-${i}`).value.trim();
                const coaches = document.getElementById(`team-coaches-${i}`).value.trim();
                const preview = document.getElementById(`logo-preview-${i}`);
                
                if (!name) {
                    alert(`Please enter a name for Team ${i + 1}`);
                    hasError = true;
                    return;
                }
                
                teams.push({
                    id: i,
                    name: name,
                    logo: preview.src && preview.style.display !== 'none' ? null : name.charAt(0).toUpperCase(),
                    logoUrl: preview.src && preview.style.display !== 'none' ? preview.src : null,
                    coaches: coaches || 'TBD',
                    budget: 100,
                    players: [],
                    maxBid: 100
                });
            }
            
            if (!hasError) {
                auctionState.teams = teams;
                renderTeams();
                updateTeamRosters();  // Add this line
                alert('Team configuration saved successfully!');
            }
        }

        // Load Default Teams
        function loadDefaultTeams() {
            const defaultTeams = [
                { name: 'Mumbai Indians', coaches: 'Rohit Sharma & Mahela Jayawardene' },
                { name: 'Chennai Kings', coaches: 'MS Dhoni & Stephen Fleming' },
                { name: 'Delhi Capitals', coaches: 'Ricky Ponting & Sourav Ganguly' },
                { name: 'Kolkata Knights', coaches: 'Brendon McCullum & Jacques Kallis' },
                { name: 'Bangalore Royals', coaches: 'Virat Kohli & Mike Hesson' },
                { name: 'Punjab Warriors', coaches: 'KL Rahul & Anil Kumble' }
            ];
            
            defaultTeams.forEach((team, index) => {
                document.getElementById(`team-name-${index}`).value = team.name;
                document.getElementById(`team-coaches-${index}`).value = team.coaches;
            });
            
            alert('Sample teams loaded! Click "Save Team Configuration" to apply.');
        }

        // Initialize Teams (simplified)
        function initializeTeams() {
            // Don't auto-create teams, wait for setup
            if (auctionState.teams.length === 0) {
                // Initialize empty team setup table
                initializeTeamSetupTable();
            } else {
                renderTeams();
            }
        }

        // Render Teams
        function renderTeams() {
            const container = document.getElementById('teams-container');
            container.innerHTML = '';

            auctionState.teams.forEach(team => {
                const teamCard = document.createElement('div');
                teamCard.className = 'team-card';
                teamCard.id = `team-${team.id}`;
                
                // Use logo URL if available, otherwise use text logo
                let logoContent = team.logo;
                if (team.logoUrl) {
                    logoContent = `<img src="${team.logoUrl}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
                }
                
                teamCard.innerHTML = `
                    <div class="team-header">
                        <div class="team-logo">${logoContent}</div>
                        <div class="team-info">
                            <h3>${team.name}</h3>
                            <div class="coaches">${team.coaches}</div>
                        </div>
                    </div>
                    <div class="budget-display">
                        <div>Remaining Budget</div>
                        <div class="budget-amount">‚Çπ${team.budget}k</div>
                        <div style="font-size: 0.9em; color: #666;">Max Bid: ‚Çπ${calculateMaxBid(team)}k</div>
                    </div>
                    <div class="bid-buttons">
                        <button class="bid-btn" onclick="placeBid(${team.id}, 0.5)">+0.5k</button>
                        <button class="bid-btn" onclick="placeBid(${team.id}, 1)">+1k</button>
                        <button class="bid-btn" onclick="placeBid(${team.id}, 2)">+2k</button>
                        <button class="bid-btn" onclick="placeBid(${team.id}, 5)">+5k</button>
                        <button class="bid-btn" onclick="placeBid(${team.id}, 10)">+10k</button>
                        <button class="bid-btn max-bid" onclick="placeMaxBid(${team.id})">MAX BID</button>
                    </div>
                    <div class="custom-bid-container">
                        <input type="number" class="custom-bid-input" id="custom-bid-${team.id}" placeholder="Custom bid (k)" step="0.5">
                        <button class="bid-btn" onclick="placeCustomBid(${team.id})">Place Custom</button>
                    </div>
                `;
                
                container.appendChild(teamCard);
            });
        }

        // Calculate Maximum Bid
        function calculateMaxBid(team) {
            const playersNeeded = 6 - team.players.length;
            const reserveBudget = Math.max(0, (playersNeeded - 1) * 2);
            return Math.max(2, team.budget - reserveBudget);
        }

        // Place Bid
        function placeBid(teamId, increment) {
            if (!auctionState.isActive || auctionState.isPaused || !auctionState.currentPlayer) {
                alert('No active auction or auction is paused!');
                return;
            }

            const team = auctionState.teams[teamId];
            const newBid = auctionState.currentBid + increment;
            const maxBid = calculateMaxBid(team);

            if (newBid > maxBid) {
                alert(`Bid exceeds maximum allowed bid of ‚Çπ${maxBid}k for ${team.name}`);
                return;
            }

            if (newBid > team.budget) {
                alert(`Insufficient budget! ${team.name} has ‚Çπ${team.budget}k remaining`);
                return;
            }

            updateBid(teamId, newBid);
        }

        // Place Max Bid
        function placeMaxBid(teamId) {
            if (!auctionState.isActive || auctionState.isPaused || !auctionState.currentPlayer) {
                alert('No active auction or auction is paused!');
                return;
            }

            const team = auctionState.teams[teamId];
            const maxBid = calculateMaxBid(team);

            if (maxBid <= auctionState.currentBid) {
                alert(`Maximum bid of ‚Çπ${maxBid}k is not higher than current bid`);
                return;
            }

            updateBid(teamId, maxBid);
        }

        // Place Custom Bid
        function placeCustomBid(teamId) {
            if (!auctionState.isActive || auctionState.isPaused || !auctionState.currentPlayer) {
                alert('No active auction or auction is paused!');
                return;
            }

            const customInput = document.getElementById(`custom-bid-${teamId}`);
            const customBid = parseFloat(customInput.value);

            if (!customBid || customBid <= 0) {
                alert('Please enter a valid bid amount');
                return;
            }

            if (customBid % 0.5 !== 0) {
                alert('Bid must be in increments of 0.5k');
                return;
            }

            const team = auctionState.teams[teamId];
            const maxBid = calculateMaxBid(team);

            if (customBid > maxBid) {
                alert(`Bid exceeds maximum allowed bid of ‚Çπ${maxBid}k for ${team.name}`);
                return;
            }

            if (customBid <= auctionState.currentBid) {
                alert('Custom bid must be higher than current bid');
                return;
            }

            updateBid(teamId, customBid);
            customInput.value = '';
        }

        // Update Bid
        function updateBid(teamId, newBid) {
            const team = auctionState.teams[teamId];
            
            // Store previous values before updating
            if (auctionState.currentBid > 0 && auctionState.leadingTeam) {
                auctionState.previousBid = auctionState.currentBid;
                auctionState.previousLeader = auctionState.leadingTeam;
            }
            
            // Update auction state
            auctionState.currentBid = newBid;
            auctionState.leadingTeam = team.name;

            // Add to bid history
            const bidEntry = {
                timestamp: new Date().toLocaleTimeString(),
                player: auctionState.currentPlayer,
                team: team.name,
                amount: newBid
            };
            auctionState.bidHistory.push(bidEntry);

            // Update display
            document.getElementById('current-bid').textContent = `‚Çπ${newBid}k`;
            document.getElementById('leading-team').textContent = team.name;
            
            // Update previous values display
            if (auctionState.previousBid > 0 && auctionState.previousLeader) {
                document.getElementById('previous-bid').textContent = `‚Çπ${auctionState.previousBid}k`;
                document.getElementById('previous-leader').textContent = auctionState.previousLeader;
            }

            // Highlight the bidding team
            document.querySelectorAll('.team-card').forEach(card => {
                card.classList.remove('highlight-bid');
            });
            document.getElementById(`team-${teamId}`).classList.add('highlight-bid');

            // Update bid history table
            updateBidHistoryTable();

            // Reset countdown timer
            resetCountdownTimer();
        }

        // Reset Countdown Timer
        function resetCountdownTimer() {
            // Clear existing timers
            if (countdownTimer) clearInterval(countdownTimer);
            if (bidCooldownTimer) clearTimeout(bidCooldownTimer);

            // Set countdown timer to inactive state
            document.getElementById('countdown-timer').textContent = '--';
            document.getElementById('countdown-timer-card').className = 'timer-card inactive';

            // Start 20-second cooldown before showing countdown
            bidCooldownTimer = setTimeout(() => {
                // Activate countdown timer (turn red)
                countdownValue = 5;
                document.getElementById('countdown-timer-card').className = 'timer-card active';
                
                countdownTimer = setInterval(() => {
                    document.getElementById('countdown-timer').textContent = countdownValue;
                    
                    if (countdownValue <= 0) {
                        clearInterval(countdownTimer);
                        // Return to inactive state
                        document.getElementById('countdown-timer-card').className = 'timer-card inactive';
                        document.getElementById('countdown-timer').textContent = '--';
                        finalizeBid();
                    }
                    
                    countdownValue--;
                }, 1000);
            }, 20000); // 20-second delay
        }

        // Finalize Bid
        function finalizeBid() {
            if (!auctionState.currentPlayer) return;

            const winningTeam = auctionState.teams.find(t => t.name === auctionState.leadingTeam);
            const playerName = auctionState.currentPlayer;
            
            // Update team budget and add player
            winningTeam.budget -= auctionState.currentBid;
            winningTeam.players.push({
                name: playerName,
                cost: auctionState.currentBid
            });

            // Add to drafted players
            auctionState.draftedPlayers.push({
                player: playerName,
                team: winningTeam.name,
                finalBid: auctionState.currentBid
            });

            // Remove from available players
            const playerIndex = auctionState.availablePlayers.indexOf(playerName);
            if (playerIndex > -1) {
                auctionState.availablePlayers.splice(playerIndex, 1);
            }

            // Update displays
            updateDraftedPlayersTable();
            displayAvailablePlayers();
            updateTeamRosters();  // Add this line

            // Show alert before reset
            alert(`${playerName} sold to ${winningTeam.name} for ‚Çπ${auctionState.currentBid}k!`);

            // Reset auction state
            resetCurrentAuction();

            // Update team displays
            renderTeams();

            // Move to next nomination
            moveToNextNomination();
        }

        // Reset Current Auction
        function resetCurrentAuction() {
            auctionState.currentPlayer = null;
            auctionState.nominatingTeam = null;
            auctionState.initialBid = 0;
            auctionState.currentBid = 0;
            auctionState.leadingTeam = null;
            auctionState.previousBid = 0;
            auctionState.previousLeader = null;

            // Clear displays
            document.getElementById('current-player').textContent = '-';
            document.getElementById('previous-leader').textContent = '-';
            document.getElementById('previous-bid').textContent = '-';
            document.getElementById('current-bid').textContent = '-';
            document.getElementById('leading-team').textContent = '-';

            // Clear timers
            if (countdownTimer) clearInterval(countdownTimer);
            if (bidCooldownTimer) clearTimeout(bidCooldownTimer);
            
            // Set countdown timer to inactive
            document.getElementById('countdown-timer').textContent = '--';
            document.getElementById('countdown-timer-card').className = 'timer-card inactive';
        }

        // Move to Next Nomination
        function moveToNextNomination() {
            auctionState.currentNominationIndex++;
            if (auctionState.currentNominationIndex >= auctionState.nominationOrder.length) {
                auctionState.currentNominationIndex = 0;
                auctionState.roundNumber++;
                alert(`Round ${auctionState.roundNumber} starting!`);
            }

            // Update the nominating team display even before timer starts
            updateNominatingTeamDisplay();
            startNominationTimer();
        }

        // Start Nomination Timer
        function startNominationTimer() {
            if (nominationTimer) clearInterval(nominationTimer);
            
            nominationValue = 90; // Reset to 1:30
            
            // Activate nomination timer (turn red)
            document.getElementById('nomination-timer-card').className = 'timer-card active';
            
            nominationTimer = setInterval(() => {
                const minutes = Math.floor(nominationValue / 60);
                const seconds = nominationValue % 60;
                document.getElementById('nomination-timer').textContent = 
                    `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                if (nominationValue <= 0) {
                    clearInterval(nominationTimer);
                    // Return to inactive state
                    document.getElementById('nomination-timer-card').className = 'timer-card inactive';
                    document.getElementById('nomination-timer').textContent = '--';
                    alert('Nomination time expired!');
                    // Auto-nominate a random player
                    autoNominate();
                }
                
                nominationValue--;
            }, 1000);

            // Update nomination section with current team
            updateNominatingTeamDisplay();
        }

        // Update Nominating Team Display
        function updateNominatingTeamDisplay() {
            const currentTeamIndex = auctionState.nominationOrder[auctionState.currentNominationIndex];
            const currentTeam = auctionState.teams[currentTeamIndex];
            
            if (currentTeam) {
                document.getElementById('nomination-team-name').textContent = `${currentTeam.name}'s Turn`;
                document.getElementById('nomination-team-name').style.color = '#dc3545';
                document.getElementById('nomination-team-name').style.fontWeight = 'bold';
            } else {
                document.getElementById('nomination-team-name').textContent = 'Waiting to Start';
                document.getElementById('nomination-team-name').style.color = '#764ba2';
                document.getElementById('nomination-team-name').style.fontWeight = 'normal';
            }
        }

        // Auto Nominate
        function autoNominate() {
            if (auctionState.availablePlayers.length === 0) {
                alert('No more players available!');
                return;
            }

            const randomPlayer = auctionState.availablePlayers[
                Math.floor(Math.random() * auctionState.availablePlayers.length)
            ];
            
            document.getElementById('player-name-input').value = randomPlayer;
            document.getElementById('starting-bid-input').value = 2;
            nominatePlayer();
        }

        // Nominate Player
        function nominatePlayer() {
            if (!auctionState.isActive || auctionState.isPaused) {
                alert('Auction is not active or is paused!');
                return;
            }

            const playerName = document.getElementById('player-name-input').value.trim();
            const startingBid = parseFloat(document.getElementById('starting-bid-input').value);

            if (!playerName) {
                alert('Please enter a player name');
                return;
            }

            if (!auctionState.availablePlayers.includes(playerName)) {
                alert('Player not in available players list or already drafted! Please check the available players list below.');
                return;
            }

            if (!startingBid || startingBid < 2) {
                alert('Starting bid must be at least 2k');
                return;
            }

            if (startingBid % 0.5 !== 0) {
                alert('Bid must be in increments of 0.5k');
                return;
            }

            const currentTeamIndex = auctionState.nominationOrder[auctionState.currentNominationIndex];
            const nominatingTeam = auctionState.teams[currentTeamIndex];

            // Set auction state
            auctionState.currentPlayer = playerName;
            auctionState.nominatingTeam = nominatingTeam.name;
            auctionState.initialBid = startingBid;
            auctionState.currentBid = startingBid;
            auctionState.leadingTeam = nominatingTeam.name;
            
            // Reset previous values for new nomination
            auctionState.previousBid = 0;
            auctionState.previousLeader = null;

            // Update displays
            document.getElementById('current-player').textContent = playerName;
            document.getElementById('previous-leader').textContent = '-';
            document.getElementById('previous-bid').textContent = '-';
            document.getElementById('current-bid').textContent = `‚Çπ${startingBid}k`;
            document.getElementById('leading-team').textContent = nominatingTeam.name;

            // Add to bid history
            auctionState.bidHistory.push({
                timestamp: new Date().toLocaleTimeString(),
                player: playerName,
                team: nominatingTeam.name,
                amount: startingBid
            });
            updateBidHistoryTable();

            // Clear nomination inputs
            document.getElementById('player-name-input').value = '';
            document.getElementById('starting-bid-input').value = '';

            // Clear nomination timer
            if (nominationTimer) clearInterval(nominationTimer);
            // Set nomination timer to inactive
            document.getElementById('nomination-timer-card').className = 'timer-card inactive';
            document.getElementById('nomination-timer').textContent = '--';

            // Start bid countdown process
            resetCountdownTimer();
        }

        // Update Bid History Table
        function updateBidHistoryTable() {
            const tbody = document.getElementById('bid-history');
            tbody.innerHTML = '';

            // Show last 10 bids
            const recentBids = auctionState.bidHistory.slice(-10).reverse();
            
            recentBids.forEach(bid => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${bid.timestamp}</td>
                    <td>${bid.player}</td>
                    <td>${bid.team}</td>
                    <td>‚Çπ${bid.amount}k</td>
                `;
            });
        }

        // Update Drafted Players Table
        function updateDraftedPlayersTable() {
            const tbody = document.getElementById('drafted-players');
            tbody.innerHTML = '';

            auctionState.draftedPlayers.forEach(draft => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${draft.player}</td>
                    <td>${draft.team}</td>
                    <td>‚Çπ${draft.finalBid}k</td>
                `;
            });
        }

        // Player Management Functions
        function addPlayers() {
            const input = document.getElementById('player-input').value.trim();
            if (!input) {
                alert('Please enter player names');
                return;
            }

            // Parse input - support both comma-separated and line-separated
            let newPlayers = [];
            if (input.includes(',')) {
                newPlayers = input.split(',').map(p => p.trim()).filter(p => p);
            } else {
                newPlayers = input.split('\n').map(p => p.trim()).filter(p => p);
            }

            // Remove duplicates and already existing players
            const uniquePlayers = [...new Set(newPlayers)];
            const addedPlayers = [];
            const duplicates = [];

            uniquePlayers.forEach(player => {
                if (!auctionState.availablePlayers.includes(player) && 
                    !auctionState.draftedPlayers.some(dp => dp.player === player)) {
                    auctionState.availablePlayers.push(player);
                    addedPlayers.push(player);
                } else {
                    duplicates.push(player);
                }
            });

            // Clear input
            document.getElementById('player-input').value = '';

            // Update display
            displayAvailablePlayers();

            // Show result
            let message = '';
            if (addedPlayers.length > 0) {
                message += `Added ${addedPlayers.length} players successfully!\n`;
            }
            if (duplicates.length > 0) {
                message += `Skipped ${duplicates.length} duplicate/drafted players.`;
            }
            if (message) {
                alert(message);
            }
        }

        function clearPlayerInput() {
            document.getElementById('player-input').value = '';
        }

        function loadSamplePlayers() {
            const samplePlayers = [
                'Virat Kohli', 'MS Dhoni', 'Rohit Sharma', 'KL Rahul', 'Hardik Pandya',
                'Jasprit Bumrah', 'Ravindra Jadeja', 'Rishabh Pant', 'Shikhar Dhawan',
                'Mohammed Shami', 'Yuzvendra Chahal', 'Suryakumar Yadav', 'Shreyas Iyer',
                'Axar Patel', 'Deepak Chahar', 'Shardul Thakur', 'Washington Sundar',
                'Ishan Kishan', 'Prithvi Shaw', 'Ruturaj Gaikwad', 'Shubman Gill',
                'Mohammed Siraj', 'Kuldeep Yadav', 'Bhuvneshwar Kumar', 'Umesh Yadav'
            ];

            document.getElementById('player-input').value = samplePlayers.join('\n');
        }

        function displayAvailablePlayers() {
            const container = document.getElementById('available-players-list');
            const availableCount = document.getElementById('available-count');
            const draftedCount = document.getElementById('drafted-count');

            // Update counts
            availableCount.textContent = auctionState.availablePlayers.length;
            draftedCount.textContent = auctionState.draftedPlayers.length;

            // Clear container
            container.innerHTML = '';

            // Get search term
            const searchTerm = document.getElementById('player-search').value.toLowerCase();

            // Filter and display players
            const filteredPlayers = auctionState.availablePlayers.filter(player => 
                player.toLowerCase().includes(searchTerm)
            );

            if (filteredPlayers.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">No players available. Add players above to get started!</div>';
                return;
            }

            filteredPlayers.sort().forEach(player => {
                const playerTag = document.createElement('div');
                playerTag.className = 'player-tag';
                playerTag.innerHTML = `
                    <span>${player}</span>
                    <span class="remove-player" onclick="removePlayer('${player.replace(/'/g, "\\'")}')" title="Remove player">‚úï</span>
                `;
                container.appendChild(playerTag);
            });
        }

        function removePlayer(playerName) {
            if (!confirm(`Remove ${playerName} from available players?`)) {
                return;
            }

            const index = auctionState.availablePlayers.indexOf(playerName);
            if (index > -1) {
                auctionState.availablePlayers.splice(index, 1);
                displayAvailablePlayers();
            }
        }

        function searchPlayers() {
            displayAvailablePlayers();
        }

        // Add autocomplete functionality for player nomination
        function setupPlayerAutocomplete() {
            const playerInput = document.getElementById('player-name-input');
            
            playerInput.addEventListener('input', function() {
                const value = this.value.toLowerCase();
                if (value.length < 2) return;

                const matches = auctionState.availablePlayers.filter(player =>
                    player.toLowerCase().includes(value)
                ).slice(0, 5);

                // You can implement a dropdown here for autocomplete suggestions
                // For now, we'll use the browser's datalist
                let datalist = document.getElementById('player-suggestions');
                if (!datalist) {
                    datalist = document.createElement('datalist');
                    datalist.id = 'player-suggestions';
                    document.body.appendChild(datalist);
                    playerInput.setAttribute('list', 'player-suggestions');
                }

                datalist.innerHTML = '';
                matches.forEach(player => {
                    const option = document.createElement('option');
                    option.value = player;
                    datalist.appendChild(option);
                });
            });
        }

        // Admin Functions
        function startAuction() {
            if (auctionState.isActive && !auctionState.isPaused) {
                alert('Auction is already active!');
                return;
            }

            // Check if teams are configured
            if (auctionState.teams.length === 0) {
                alert('Please configure teams before starting the auction! Use the Team Setup section below.');
                return;
            }

            // Check if players are added
            if (auctionState.availablePlayers.length === 0) {
                alert('Please add players before starting the auction!');
                return;
            }

            auctionState.isActive = true;
            auctionState.isPaused = false;

            // Enable all team bid buttons
            document.querySelectorAll('.team-card .bid-btn').forEach(btn => {
                btn.disabled = false;
            });
            
            // Enable nomination button
            const nominateBtn = document.querySelector('.nomination-form .bid-btn');
            if (nominateBtn) {
                nominateBtn.disabled = false;
            }

            // Start nomination timer for first team
            if (!auctionState.currentPlayer) {
                updateNominatingTeamDisplay();  // Show first team immediately
                startNominationTimer();
            }

            alert('Auction started!');
        }

        function pauseAuction() {
            if (!auctionState.isActive) {
                alert('No active auction to pause!');
                return;
            }

            auctionState.isPaused = !auctionState.isPaused;

            if (auctionState.isPaused) {
                // Pause all timers
                if (countdownTimer) clearInterval(countdownTimer);
                if (nominationTimer) clearInterval(nominationTimer);
                if (bidCooldownTimer) clearTimeout(bidCooldownTimer);

                // Set both timers to inactive state
                document.getElementById('countdown-timer-card').className = 'timer-card inactive';
                document.getElementById('countdown-timer').textContent = '--';
                document.getElementById('nomination-timer-card').className = 'timer-card inactive';
                document.getElementById('nomination-timer').textContent = '--';

                // Disable all team bid buttons
                document.querySelectorAll('.team-card .bid-btn').forEach(btn => {
                    btn.disabled = true;
                });
                
                // Disable nomination button
                const nominateBtn = document.querySelector('.nomination-form .bid-btn');
                if (nominateBtn) {
                    nominateBtn.disabled = true;
                }

                alert('Auction paused!');
            } else {
                // Resume timers
                if (auctionState.currentPlayer) {
                    resetCountdownTimer();
                } else {
                    startNominationTimer();
                }

                // Enable all team bid buttons
                document.querySelectorAll('.team-card .bid-btn').forEach(btn => {
                    btn.disabled = false;
                });
                
                // Enable nomination button
                const nominateBtn = document.querySelector('.nomination-form .bid-btn');
                if (nominateBtn) {
                    nominateBtn.disabled = false;
                }

                alert('Auction resumed!');
            }
        }

        function undoLastBid() {
            if (auctionState.bidHistory.length <= 1) {
                alert('No bid to undo!');
                return;
            }

            // Remove last bid
            auctionState.bidHistory.pop();

            // Get previous bid
            const previousBid = auctionState.bidHistory[auctionState.bidHistory.length - 1];
            
            if (previousBid) {
                // Store current as previous before reverting
                auctionState.previousBid = auctionState.currentBid;
                auctionState.previousLeader = auctionState.leadingTeam;
                
                // Revert to previous bid
                auctionState.currentBid = previousBid.amount;
                auctionState.leadingTeam = previousBid.team;

                // Update displays
                document.getElementById('current-bid').textContent = `‚Çπ${previousBid.amount}k`;
                document.getElementById('leading-team').textContent = previousBid.team;
                
                // Update previous bid display if we have more than initial bid
                if (auctionState.bidHistory.length > 1) {
                    const priorBid = auctionState.bidHistory[auctionState.bidHistory.length - 2];
                    if (priorBid) {
                        document.getElementById('previous-bid').textContent = `‚Çπ${priorBid.amount}k`;
                        document.getElementById('previous-leader').textContent = priorBid.team;
                    }
                } else {
                    // Back to initial bid, no previous
                    document.getElementById('previous-bid').textContent = '-';
                    document.getElementById('previous-leader').textContent = '-';
                }

                // Update bid history table
                updateBidHistoryTable();

                // Reset countdown
                resetCountdownTimer();

                alert('Last bid undone!');
            }
        }

        function resetAuction() {
            if (!confirm('Are you sure you want to reset the entire auction? This will clear all data!')) {
                return;
            }

            // Clear all timers
            if (countdownTimer) clearInterval(countdownTimer);
            if (nominationTimer) clearInterval(nominationTimer);
            if (bidCooldownTimer) clearTimeout(bidCooldownTimer);

            // Reset timers to inactive state
            document.getElementById('countdown-timer-card').className = 'timer-card inactive';
            document.getElementById('countdown-timer').textContent = '--';
            document.getElementById('nomination-timer-card').className = 'timer-card inactive';
            document.getElementById('nomination-timer').textContent = '--';

            // Reset nomination team display
            document.getElementById('nomination-team-name').textContent = 'Waiting to Start';
            document.getElementById('nomination-team-name').style.color = '#764ba2';
            document.getElementById('nomination-team-name').style.fontWeight = 'normal';

            // Reset state
            auctionState = {
                isActive: false,
                isPaused: false,
                currentPlayer: null,
                nominatingTeam: null,
                initialBid: 0,
                currentBid: 0,
                leadingTeam: null,
                teams: [],
                bidHistory: [],
                draftedPlayers: [],
                availablePlayers: [],
                nominationOrder: [],
                currentNominationIndex: 0,
                roundNumber: 1
            };

            // Clear displays
            resetCurrentAuction();
            document.getElementById('bid-history').innerHTML = '';
            document.getElementById('drafted-players').innerHTML = '';
            document.getElementById('teams-container').innerHTML = '';

            // Re-initialize
            initializeTeams();
            auctionState.nominationOrder = [0, 1, 2, 3, 4, 5];
            displayAvailablePlayers();

            // Disable only team bid buttons and nomination button
            document.querySelectorAll('.team-card .bid-btn').forEach(btn => {
                btn.disabled = true;
            });
            
            const nominateBtn = document.querySelector('.nomination-form .bid-btn');
            if (nominateBtn) {
                nominateBtn.disabled = true;
            }

            alert('Auction reset! Please add players and start again.');
        }

        function exportData() {
            // Prepare data for export
            const exportData = {
                timestamp: new Date().toISOString(),
                round: auctionState.roundNumber,
                teams: auctionState.teams.map(team => ({
                    name: team.name,
                    budget: team.budget,
                    players: team.players
                })),
                draftedPlayers: auctionState.draftedPlayers,
                bidHistory: auctionState.bidHistory
            };

            // Convert to CSV format
            let csvContent = "Auction Data Export\n";
            csvContent += `Date: ${new Date().toLocaleDateString()}\n`;
            csvContent += `Round: ${auctionState.roundNumber}\n\n`;

            // Team Summary
            csvContent += "TEAM SUMMARY\n";
            csvContent += "Team,Remaining Budget,Players Drafted,Total Spent\n";
            auctionState.teams.forEach(team => {
                const totalSpent = 100 - team.budget;
                csvContent += `${team.name},${team.budget}k,${team.players.length},${totalSpent}k\n`;
            });

            csvContent += "\nDRAFTED PLAYERS\n";
            csvContent += "Player,Team,Final Bid\n";
            auctionState.draftedPlayers.forEach(draft => {
                csvContent += `${draft.player},${draft.team},${draft.finalBid}k\n`;
            });

            csvContent += "\nBID HISTORY\n";
            csvContent += "Timestamp,Player,Team,Bid Amount\n";
            auctionState.bidHistory.forEach(bid => {
                csvContent += `${bid.timestamp},${bid.player},${bid.team},${bid.amount}k\n`;
            });

            // Create download link
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `auction_data_round_${auctionState.roundNumber}_${Date.now()}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);

            alert('Data exported! Check your downloads folder.');

            // Note: For actual Google Sheets integration, you would need to implement
            // Google Sheets API with proper authentication
            console.log('For Google Sheets integration, implement API connection here');
        }

        // Update Team Rosters Display
        function updateTeamRosters() {
            const container = document.getElementById('team-rosters');
            container.innerHTML = '';
            
            auctionState.teams.forEach(team => {
                const rosterCard = document.createElement('div');
                rosterCard.className = 'roster-card';
                
                // Create logo content
                let logoContent = team.logo;
                if (team.logoUrl) {
                    logoContent = `<img src="${team.logoUrl}" alt="${team.name}">`;
                }
                
                // Calculate stats
                const totalSpent = 100 - team.budget;
                const playersCount = team.players.length;
                const remainingSlots = 6 - playersCount;
                
                // Create players list HTML
                let playersHtml = '';
                if (team.players.length > 0) {
                    team.players.forEach(player => {
                        playersHtml += `
                            <div class="roster-player">
                                <span class="player-name">${player.name}</span>
                                <span class="player-cost">‚Çπ${player.cost}k</span>
                            </div>
                        `;
                    });
                } else {
                    playersHtml = '<div class="roster-empty">No players drafted yet</div>';
                }
                
                rosterCard.innerHTML = `
                    <div class="roster-header">
                        <div class="roster-logo">${logoContent}</div>
                        <div class="roster-info">
                            <h4>${team.name}</h4>
                            <div class="roster-stats">
                                <span>Players: ${playersCount}/6</span>
                                <span>‚Ä¢</span>
                                <span>Slots: ${remainingSlots}</span>
                            </div>
                        </div>
                    </div>
                    <div class="roster-players">
                        ${playersHtml}
                    </div>
                    <div class="roster-summary">
                        <span class="budget-left">Budget: ‚Çπ${team.budget}k</span>
                        <span class="total-spent">Spent: ‚Çπ${totalSpent}k</span>
                    </div>
                `;
                
                container.appendChild(rosterCard);
            });
        }
        window.onload = function() {
            initializeTeams();
            
            // Set initial available players - empty by default
            auctionState.availablePlayers = [];

            // Set default nomination order (snake: 0,1,2,3,4,5)
            auctionState.nominationOrder = [0, 1, 2, 3, 4, 5];

            // Disable ONLY bid buttons initially - not admin or player management buttons
            document.querySelectorAll('.team-card .bid-btn').forEach(btn => {
                btn.disabled = true;
            });
            
            // Also disable nomination button initially
            const nominateBtn = document.querySelector('.nomination-form .bid-btn');
            if (nominateBtn) {
                nominateBtn.disabled = true;
            }

            // Display empty player list
            displayAvailablePlayers();

            // Setup autocomplete
            setupPlayerAutocomplete();
        };
    </script>
</body>
</html>